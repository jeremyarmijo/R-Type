R-Type Network Protocol Specification

Status of This Memo
   This document specifies the R-Type Network Protocol, a custom
   application-layer protocol designed for a real-time multiplayer
   shoot'em up game.

Table of Contents
   1. Introduction
   2. Terminology
   3. Protocol Overview
   4. Transport Protocols
       4.1 TCP Usage
       4.2 UDP Usage
   5. Common Message Format
       5.1 Header Format
       5.2 Flags
   6. TCP Messages
       6.1 LOGIN_REQUEST (0x01)
       6.2 LOGIN_RESPONSE (0x02)
       6.3 LOBBY_CREATE (0x03)
       6.4 LOBBY_JOIN_REQUEST (0x04)
       6.5 LOBBY_JOIN_RESPONSE (0x05)
       6.6 LOBBY_LIST_REQUEST (0x06)
       6.7 LOBBY_LIST_RESPONSE (0x07)
       6.8 PLAYER_READY (0x08)
       6.9 LOBBY_UPDATE (0x09)
       6.10 LOBBY_LEAVE (0x0A)
       6.11 LOBBY_START (0x0B)
       6.12 GAME_START (0x0F)
       6.13 GAME_END (0x10)
       6.14 ERROR (0x12)
   7. UDP Messages
       7.1 PLAYER_INPUT (0x20)
       7.2 GAME_STATE (0x21)
       7.3 AUTH (0x22)
       7.4 BOSS_SPAWN (0x23)
       7.5 BOSS_UPDATE (0x24)
       7.6 ENEMY_HIT (0x25)
   8. Error Handling
   9. Security Considerations
   10. Message Type Summary

1. Introduction
   The R-Type Network Protocol defines the communication rules between
   clients and servers for authentication, game state synchronization,
   and real-time gameplay events. The protocol uses both TCP and UDP
   to balance reliability and latency constraints.

2. Terminology
   Client: Game instance controlled by a player.
   Server: Authoritative game server.
   Payload: Message-specific data following the common header.

3. Protocol Overview
   The protocol follows a client-server architecture. Critical operations
   such as authentication and game lifecycle management are transmitted
   over TCP, while real-time gameplay data is exchanged over UDP.

4. Transport Protocols
4.1 TCP Usage
   TCP MUST be used for:
   - Authentication
   - Lobby management
   - Game start and end notifications
   - Error reporting

4.2 UDP Usage
   UDP MUST be used for:
   - Player inputs
   - Game state synchronization
   - Entity updates

5. Common Message Format
   All protocol messages share a common 6-byte header.

5.1 Header Format

Field         Size    Description
Type          8b      Message type identifier
Flags         8b      Protocol flags
Length        32b     Payload length (big-endian)

5.2 Flags
Bit  Mask  Meaning
0    0x01  TCP message
1    0x02  UDP message
3    0x08  Requires ACK (UDP)

6. TCP Messages
6.1 LOGIN_REQUEST (0x01)
   Direction: Client → Server

Offset  Field       Size   Description
0       usernameLen 8b     Username length
1       username    N      UTF-8 username
1+N     passwordLen 8b     Password length
2+N     password    N      Client-side hashed password

6.2 LOGIN_RESPONSE (0x02)
   Direction: Server → Client

   Success Response:
Offset  Field       Size   Description
0       success     8b     MUST be 1
1       playerId    16b    Assigned player identifier
3       udpPort     16b    UDP gameplay port

   Failure Response:
Offset  Field       Size   Description
0       success     8b     MUST be 0
1       errorCode   16b    Error code
3       messageLen  8b     Error message length
4       message     N      UTF-8 error message

   Defined error codes:
   - 0x1001: Invalid credentials
   - 0x1002: Account banned
   - 0x1003: Already connected
   - 0x1004: Server full

6.3 LOBBY_CREATE (0x03)
   Direction: Client → Server

Offset  Field       Size   Description
0       passwordLen 8b     Password length (0 = no password)
1       password    N      UTF-8 password (optional)
1+N     difficulty  8b     Game difficulty (1-3)

6.4 LOBBY_JOIN_REQUEST (0x04)
   Direction: Client → Server

Offset  Field       Size   Description
0       lobbyId     16b    Target lobby identifier
2       passwordLen 8b     Password length
3       password    N      UTF-8 password

6.5 LOBBY_JOIN_RESPONSE (0x05)
   Direction: Server → Client

   Success Response:
Offset  Field       Size   Description
0       success     8b     MUST be 1
1       lobbyId     16b    Joined lobby ID
3       playerId    16b    Assigned player ID
5       playerCount 8b     Current number of players
6       players     N      Array of player info

   Each player info entry (variable length):
Field       Size   Description
playerId    16b    Player identifier
ready       8b     Ready state (0=not ready, 1=ready)
usernameLen 8b     Username length
username    N      UTF-8 username

   Failure Response:
Offset  Field       Size   Description
0       success     8b     MUST be 0
1       errorCode   16b    Error code
3       messageLen  8b     Error message length
4       message     N      UTF-8 error message

   Defined error codes:
   - 0x2010: Lobby not found
   - 0x2011: Invalid password
   - 0x2012: Lobby is full
   - 0x2013: Player already in a lobby
   - 0x2014: Game already started

6.6 LOBBY_LIST_REQUEST (0x06)
   Direction: Client → Server

   No payload - message header only

6.7 LOBBY_LIST_RESPONSE (0x07)
   Direction: Server → Client

Offset  Field       Size   Description
0       lobbyCount  8b     Number of lobbies
1       lobbies     N      Array of lobby info

   Each lobby info entry is 7 bytes:
Field         Size   Description
lobbyId       16b    Lobby identifier
playerCount   8b     Current player count
maxPlayers    8b     Maximum players (always 4)
difficulty    8b     Game difficulty (1-3)
isStarted     8b     Game started (0=no, 1=yes)
hasPassword   8b     Password protected (0=no, 1=yes)

6.8 PLAYER_READY (0x08)
   Direction: Client → Server

Offset  Field       Size   Description
0       ready       8b     Ready state (0=not ready, 1=ready)

6.9 LOBBY_UPDATE (0x09)
   Direction: Server → Clients (Broadcast)

Offset  Field       Size   Description
0       playerCount 8b     Current number of players
1       players     N      Array of player info

   Each player info entry (variable length):
Field       Size   Description
playerId    16b    Player identifier
ready       8b     Ready state (0=not ready, 1=ready)
usernameLen 8b     Username length
username    N      UTF-8 username

6.10 LOBBY_LEAVE (0x0A)
   Direction: Client → Server

   No payload - message header only

6.11 LOBBY_START (0x0B)
   Direction: Server → Clients (Broadcast)

Offset  Field       Size   Description
0       countdown   8b     Seconds until game starts

6.12 GAME_START (0x0F)
   Direction: Server → Clients
Field        Size   Description
playerSpawnX 32b    Initial X position
playerSpawnY 32b    Initial Y position
scrollSpeed  32b    Initial scroll speed

6.13 GAME_END (0x10)
   Direction: Server → Clients
Field        Size   Description
victory     8b      Match result
playerCount 8b      Number of players
scores      N       Final scores

   Each score entry is 8 bytes:
Field      Size   Description
playerId   16b    Player ID
score      32b    Final score
rank       8b     Player rank

6.14 ERROR (0x12)
   Direction: Server → Client
Field       Size   Description
errorCode   16b    Error code
messageLen  8b     Message length
message     N      UTF-8 error description

7. UDP Messages
7.1 PLAYER_INPUT (0x20)
   Direction: Client → Server
Field       Size   Description
up          8b     Up input
down        8b     Down input
left        8b     Left input
right       8b     Right input
fire        8b     Fire bitfield

   Fire bits:
   - Bit 0: Primary fire
   - Bit 1: Charged fire

7.2 GAME_STATE (0x21)
   Direction: Server → Clients
   The GAME_STATE message contains serialized arrays of players, enemies,
   and projectiles. The server MUST be authoritative.

7.3 AUTH (0x22)
   Direction: Client → Server
Field       Size   Description
playerId    16b    Player identifier

7.4 BOSS_SPAWN (0x23)
   Direction: Server → Clients
Field       Size   Description
bossId      16b    Boss ID
bossType    8b     Boss type
maxHp       16b    Maximum HP
phase       8b     Initial phase

7.5 BOSS_UPDATE (0x24)
   Direction: Server → Clients
Field       Size   Description
bossId      16b    Boss ID
posX        32b    X position
posY        32b    Y position
hp          16b    Current HP
phase       8b     Current phase
action      8b     Current action

7.6 ENEMY_HIT (0x25)
   Direction: Server → Clients
Field       Size   Description
enemyId     16b    Enemy ID
damage      8b     Damage dealt
hpRemaining 16b    Remaining HP

8. Error Handling
   Clients receiving malformed or unknown messages SHOULD discard them
   silently. Fatal errors MUST be reported using the ERROR message over TCP.

9. Security Considerations
   Passwords MUST NOT be transmitted in plain text.
   UDP messages SHOULD be rate-limited.
   The server MUST validate all client inputs.

10. Message Type Summary
TCP:
0x01 LOGIN_REQUEST
0x02 LOGIN_RESPONSE
0x03 LOBBY_CREATE
0x04 LOBBY_JOIN_REQUEST
0x05 LOBBY_JOIN_RESPONSE
0x06 LOBBY_LIST_REQUEST
0x07 LOBBY_LIST_RESPONSE
0x08 PLAYER_READY
0x09 LOBBY_UPDATE
0x0A LOBBY_LEAVE
0x0B LOBBY_START
0x0F GAME_START
0x10 GAME_END
0x12 ERROR

UDP:
0x20 PLAYER_INPUT
0x21 GAME_STATE
0x22 AUTH
0x23 BOSS_SPAWN
0x24 BOSS_UPDATE
0x25 ENEMY_HIT

Sequence Diagram
   A detailed sequence diagram illustrating the client-server interaction
   flow (authentication, UDP setup, gameplay loop, and game termination)
   is provided at the following location:
   https://drive.google.com/file/d/1BYFZ8Wbi0jx-oA9SjRvfW7JBy5_cQgSa/view

Class Diagram 
    A detailed class diagram illustrating the main entities and relationships
    of the R-Type game server and client architecture is available at 
    the following location: 
    https://drive.google.com/file/d/1nSUk1KHArsoXm9TfdPUM-eLnLMxiH3Nd/view?usp=sharing