name: Clang-Tidy (Google checks)

on:
  push:
    branches:
      - "**"
  pull_request:
    branches:
      - "**"

jobs:
  clang-tidy:
    if: github.repository == 'jeremyarmijo/R-Type'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install clang-tidy
        run: |
          sudo apt-get update
          sudo apt-get install -y clang-tidy

      - name: Run clang-tidy with google style checks
        run: |
          FILES=$(git ls-files '*.c' '*.cpp' '*.h' '*.hpp' || true)
          if [ -z "$FILES" ]; then
            echo "No source files found, skipping clang-tidy"
            exit 0
          fi
          EXIT_CODE=0
          echo "$FILES" | tr ' ' '\n' | while read -r FILE; do
            echo "Running clang-tidy on: $FILE"
            clang-tidy "$FILE" -checks='google-*' -- -Iinclude -std=c++20 || EXIT_CODE=1
          done
          if [ "$EXIT_CODE" -ne 0 ]; then
            echo "clang-tidy found issues"
            exit 1
          fi
